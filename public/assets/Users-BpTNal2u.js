import{r as s,bi as S,bj as w,t as F,k as D,n as r,l as e,ad as f,S as v,Q as m,ac as g,w as B,bp as V,bq as A,b5 as T,bn as L,br as R,bs as z,bm as P,bt as $,bo as j,bk as I,bl as Q,D as K}from"./index-7VV-N64s.js";import{u as H}from"./useUsers-CJv798T0.js";import{D as G}from"./DialogFullscreen-4Q7iLXx3.js";import{B as J,V as W}from"./ViewBankAccount-CPJOo8QL.js";import{E as X}from"./EditOutlined-BTAsILK6.js";import"./Toolbar-C-RIKFYh.js";var Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 512a48 48 0 1096 0 48 48 0 10-96 0zm200 0a48 48 0 1096 0 48 48 0 10-96 0zm-400 0a48 48 0 1096 0 48 48 0 10-96 0zm661.2-173.6c-22.6-53.7-55-101.9-96.3-143.3a444.35 444.35 0 00-143.3-96.3C630.6 75.7 572.2 64 512 64h-2c-60.6.3-119.3 12.3-174.5 35.9a445.35 445.35 0 00-142 96.5c-40.9 41.3-73 89.3-95.2 142.8-23 55.4-34.6 114.3-34.3 174.9A449.4 449.4 0 00112 714v152a46 46 0 0046 46h152.1A449.4 449.4 0 00510 960h2.1c59.9 0 118-11.6 172.7-34.3a444.48 444.48 0 00142.8-95.2c41.3-40.9 73.8-88.7 96.5-142 23.6-55.2 35.6-113.9 35.9-174.5.3-60.9-11.5-120-34.8-175.6zm-151.1 438C704 845.8 611 884 512 884h-1.7c-60.3-.3-120.2-15.3-173.1-43.5l-8.4-4.5H188V695.2l-4.5-8.4C155.3 633.9 140.3 574 140 513.7c-.4-99.7 37.7-193.3 107.6-263.8 69.8-70.5 163.1-109.5 262.8-109.9h1.7c50 0 98.5 9.7 144.2 28.9 44.6 18.7 84.6 45.6 119 80 34.3 34.3 61.3 74.4 80 119 19.4 46.2 29.1 95.2 28.9 145.8-.6 99.6-39.7 192.9-110.1 262.7z"}}]},name:"message",theme:"outlined"},N=function(d,o){return s.createElement(S,w(w({},d),{},{ref:o,icon:Y}))};N.displayName="MessageOutlined";const Z=s.forwardRef(N);var _={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"},O=function(d,o){return s.createElement(S,w(w({},d),{},{ref:o,icon:_}))};O.displayName="StarOutlined";const ee=s.forwardRef(O);function ae({user:l,handleSave:d,oncancel:o}){const[a,c]=s.useState(),{data:i}=F({queryKey:["roles",l==null?void 0:l._id],queryFn:async({signal:n})=>(await D.get("/grants/roles",{signal:n})).data,initialData:[]}),p=async n=>{if(n){if(n.password!==n.currentPassword){m.error("Password does not match");return}d(n)}};return r("form",{className:"p-5 grid sm:grid-cols-2 gap-3",onSubmit:n=>{n.preventDefault(),p(a)},children:[r("div",{children:[e(g,{required:!0,children:"Name"}),e(f,{type:"text",value:(a==null?void 0:a.name)??(l==null?void 0:l.name),onChange:n=>c({...a,name:n.target.value}),disabled:!1,required:!0,placeholder:"First Last"})]}),r("div",{children:[e(g,{required:!0,children:"Email"}),e(f,{type:"text",value:(a==null?void 0:a.email)??(l==null?void 0:l.email),onChange:n=>c({...a,email:n.target.value}),disabled:!1,required:!0})]}),r("div",{children:[e(g,{required:!0,children:"password"}),e(f,{type:"password",value:a==null?void 0:a.password,onChange:n=>c({...a,password:n.target.value})})]}),r("div",{children:[e(g,{required:!0,children:"Confirm password"}),e(f,{type:"password",value:a==null?void 0:a.currentPassword,onChange:n=>c({...a,currentPassword:n.target.value})})]}),r("div",{children:[e(g,{required:!0,children:"Role"}),r(v,{value:(a==null?void 0:a.role)??(l==null?void 0:l.role),onChange:n=>c({...a,role:n.target.value}),disabled:!1,required:!0,children:[e("option",{value:"",selected:!0,disabled:!0,children:"Select Role"}),i.map(n=>e("option",{value:n,children:n},n))]})]}),r("div",{children:[e(g,{children:"2FA"}),r(v,{value:(a==null?void 0:a.twoFactorAuthEnabled)??(l==null?void 0:l.twoFactorAuthEnabled),onChange:n=>c({...a,twoFactorAuthEnabled:n.target.value}),disabled:!1,required:!0,children:[e("option",{value:!0,children:"Enabled"}),e("option",{value:!1,children:"Disabled"})]})]}),r("div",{children:[e(g,{required:!0,children:"Status"}),r(v,{value:(a==null?void 0:a.disabled)??(l==null?void 0:l.disabled),onChange:n=>c({...a,disabled:n.target.value}),disabled:!1,required:!0,children:[e("option",{value:!0,children:"Blocked"}),e("option",{value:!1,children:"Active"})]})]}),r("div",{children:[e(g,{required:!0,children:"Verified"}),r(v,{value:(a==null?void 0:a.verified)??(l==null?void 0:l.verified),onChange:n=>c({...a,verified:n.target.value}),disabled:!1,required:!0,children:[e("option",{value:!0,children:"Verified"}),e("option",{value:!1,children:"Not Verified"})]})]}),r("div",{className:"flex gap-3",children:[e("button",{type:"submit",className:"bg-green-500 text-black px-3 py-1 rounded-md",children:"Save"}),e("button",{type:"reset",onClick:o,className:"bg-red-500 text-white px-3 py-1 rounded-md",children:"Cancel"})]})]})}function q({renderedCellValue:l}){const d=l;return r("div",{className:"flex items-center gap-2",children:[e("div",{className:"rounded-full text-xl",children:d?e(V,{className:"text-green-500"}):e(A,{className:"text-red-500"})}),e("p",{className:"text-sm font-bold text-navy-700 ",children:d?"Active":"Blocked"})]})}q.propTypes={renderedCellValue:B.bool};const se=()=>{const[l,d]=s.useState(!1),[o,u]=s.useState(!1),[a,c]=s.useState(!1),i=s.useRef(null),{deleteUser:p,updateUser:n,createUser:C}=H(),b=T(),{query:y,...M}=L({queryKey:["users"],queryFn:async(t,h)=>{const k=await D.get("/auth/users",{params:t,signal:h});return{data:k.data.users,total:k.data.total}}}),E=s.useCallback(async()=>{i.current&&m.promise(async()=>{await p(i.current._id),i.current=null,d(!1)},{pending:"Deleting...",success:"Deleted successfully",error:"An error occurred while deleting"})},[p]),x=s.useCallback(async(t,h)=>{t&&m.promise(async()=>{await n({id:t,data:{disabled:!h}},{onSuccess:()=>{y.refetch()}})},{pending:"Updating...",success:"Updated successfully",error:"An error occurred while updating"})},[n,y]),U=s.useMemo(()=>[{id:"id",header:"ID",accessorFn:t=>t.id??"N/A"},{id:"name",header:"NAME",accessorFn:t=>t.name.toUpperCase()},{id:"email",header:"EMAIL",accessorFn:t=>t.email},{id:"role",header:"ROLE",accessorFn:t=>t.role},{id:"disabled",header:"STATUS",accessorFn:t=>!t.disabled,Cell:q},{id:"actions",header:"ACTIONS",Cell:t=>e(P,{menu:{items:[{id:"edit",label:"Edit",icon:e(X,{}),onClick:()=>{i.current=t.row.original,u(!0)}},{id:"delete",label:"Delete",danger:!0,icon:e(R,{}),onClick:()=>{i.current=t.row.original,d(!0)}},{id:"disable",icon:e(A,{}),label:t.row.original.disabled?"Enable":"Disable",onClick:()=>x(t.row.original._id,t.row.original.disabled)},{id:"bookings",icon:e(z,{}),label:"View Bookings",onClick:()=>b(`/admin/booking-management?user=${t.row.original._id}`)},{id:"bankAccount",icon:e(J,{}),label:"View Bank Account",onClick:()=>{i.current=t.row.original,c(!0)}},{id:"reviews",icon:e(ee,{}),label:"View Reviews",onClick:()=>b(`/admin/review-management?user=${t.row.original._id}`)},{id:"sendMessage",label:"Send Message",icon:e(Z,{}),onClick:()=>b("/admin/messages",{state:{chat:t.row.original._id,name:t.row.original.name}})}]},children:e("a",{onClick:h=>h.preventDefault(),children:r(Q,{children:["Manage",e(I,{})]})})})}],[b,x]);return r("div",{className:"mt-0 grid h-full grid-cols-1 gap-5",children:[e(j,{columns:U,...M,renderTopToolbarCustomActions:()=>e("div",{className:" flex gap-1 items-center",children:e($,{onClick:()=>{i.current=null,u(!0)}})})}),e(G,{open:o,onClose:()=>{i.current=null,u(!1)},children:e(ae,{user:i.current,oncancel:()=>{i.current=null,u(!1)},handleSave:async t=>{t&&(i.current?m.promise(async()=>{await n({id:i.current._id,data:t},{onSuccess:async()=>{u(!1)}})},{pending:"Updating...",success:"Updated successfully",error:"An error occurred while updating"}):m.promise(async()=>{await C(t),u(!1)},{pending:"Creating...",success:"Created successfully",error:"An error occurred while creating"}))}})}),e(K,{open:l,onClose:()=>d(!1),children:r("div",{className:"p-5",children:[e("h2",{className:"text-lg font-bold",children:"Are you sure you want to delete?"}),r("div",{className:"flex justify-end gap-3 mt-5",children:[e("button",{onClick:()=>d(!1),className:"text-sm text-white bg-red-500 px-2 py-1 rounded-md",children:"Cancel"}),e("button",{onClick:E,className:"text-sm text-white bg-green-500 px-2 py-1 rounded-md",children:"Delete"})]})]})}),e(W,{user:i.current,open:a,onClose:()=>{c(!1),i.current=null}})]})};export{se as default};
