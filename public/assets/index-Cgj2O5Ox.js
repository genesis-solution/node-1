import{r as h,bi as Q,bj as P,w as C,a0 as W,Q as F,k as w,l as t,bF as J,n as c,ac as N,S as R,bG as X,a7 as Y,x as z,D as Z,bn as ee,ck as te,bp as q,bq as V,cl as ae,br as re,cm as ie,bk as ne,bl as se,bm as le,af as I,bt as oe,cn as ce,bo as de,F as G}from"./index-CYYMkemY.js";import{u as ue}from"./useUsers-CbMfyjZQ.js";import{S as me,u as he}from"./useDeleteSpot-v4Hri0ey.js";import{S as pe}from"./Spot-BQhcZjWC.js";import{D as fe}from"./DialogFullscreen-x-GnnSsf.js";import{r as ge}from"./index-BqxZWrqY.js";import{u as ve}from"./useAmenities-D0xJys_W.js";import{u as be}from"./useCityAndStates-XSqDR4bf.js";import{R as ye}from"./Reservations-CSlBBA74.js";import"./StepSeven-CaftNgHu.js";import{A as E,a as M}from"./AvatarGroup-DkV5TBGl.js";import{E as Se}from"./EditOutlined-B7aMbCoQ.js";import{C as Ce}from"./CalendarOutlined-B1t4GR24.js";import"./swiper-DX2zQgap.js";import"./ChangeView-C20L4T_u.js";import"./MapEvents-DdZzM7En.js";import"./useCategories-DjRaMXom.js";import"./BetterTimePicker-4mNBZ52D.js";import"./index-BiQ69Uv7.js";import"./transition-D9da72fo.js";import"./Toolbar-vOywhSsd.js";import"./Calender-DpzEOgDa.js";import"./react-big-calendar.esm-DG5-TkVK.js";import"./useBooking-a8R0x6U_.js";var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"},B=function(f,s){return h.createElement(Q,P(P({},f),{},{ref:s,icon:Fe}))};B.displayName="HomeOutlined";const we=h.forwardRef(B);function T({open:v,onClose:f,refetch:s,spot:r,disabled:o=!1}){var _,D,j,k,O,L;const{users:b}=ue({params:{role:"host",size:99999}}),[S,x]=h.useState(((D=(_=r==null?void 0:r.current)==null?void 0:_.owner)==null?void 0:D._id)??((j=r==null?void 0:r.current)==null?void 0:j.owner)),[A,n]=h.useState(!1);W(),console.log();const u=h.useRef((r==null?void 0:r.current)??{availability:pe.availability}),p=d=>{o||(u.current={...u.current,...d})},g=d=>{const y=d.target.value;console.log({user:y}),x(y),u.current.owner=y},H=ge.useAsyncDebounce(async d=>{var e;if(!d)return;console.log({_spot:d});const y=((e=d.owner)==null?void 0:e._id)??d.owner??S;if(!y)return F.error("Please select a user");const $={...d,owner:y,draft:!1};console.log({data:$});try{await F.promise(async()=>{n(!0),await w.patchForm("/product",$),r&&(r.current=null),s(),f(),await new Promise(a=>setTimeout(a,1e3))},{success:"Spot saved successfully",pending:"Saving Spot...",error:{render({data:a}){var i,l;return console.log(a),((l=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:l.message)||"Failed to save spot"}}})}finally{n(!1)}},500);return h.useEffect(()=>{u.current=(r==null?void 0:r.current)??u.current,console.log({current:(r==null?void 0:r.current)??u.current})},[r==null?void 0:r.current]),t(fe,{open:v,onClose:f,children:t("div",{className:"w-full mt-1",children:t(J,{children:c(X,{title:"Listing",children:[t(N,{required:!0,children:"User"}),c(R,{value:((O=(k=r==null?void 0:r.current)==null?void 0:k.owner)==null?void 0:O._id)??((L=r==null?void 0:r.current)==null?void 0:L.owner)??S,onChange:g,disabled:o,children:[t("option",{value:"",disabled:!0,selected:!0,children:"Select User"}),b.map(d=>t("option",{value:d._id,children:d.name},d._id))]}),t(me,{initial:u.current,spotRef:u,onChange:p,onSave:H,disabled:A||o})]})})})})}T.propTypes={open:C.bool,onClose:C.func,refetch:C.func,spot:C.object,disabled:C.bool};function xe(){return Y({mutationKey:"update-status-spot",mutationFn:async({id:f,status:s})=>{const r=`/product/${f}/${s}`;return(await w.patch(r)).data}})}function K({open:v,onClose:f}){const[s,r]=z(),{states:o,cities:b}=be({state:s.get("state")}),{amenities:S}=ve(),[x,A]=h.useState([]);return t(Z,{open:v,onClose:f,fullWidth:!0,children:c("form",{className:"p-4 flex flex-col gap-3",onSubmit:n=>n.preventDefault(),children:[c("div",{children:[t(N,{children:"State"}),c(R,{name:"state",value:s.get("state"),onChange:n=>{s.set("state",n.target.value),r(s)},children:[t("option",{value:"",children:"All"}),o.map(n=>t("option",{value:n,children:n},n))]})]}),c("div",{children:[t(N,{children:"City"}),c(R,{name:"city",value:s.get("city"),onChange:n=>{s.set("city",n.target.value),r(s)},children:[t("option",{value:"",children:"All"}),b.map(n=>t("option",{value:n,children:n},n))]})]}),c("div",{children:[t(N,{children:"Type"}),c(R,{name:"type",value:s.get("type"),onChange:n=>{s.set("type",n.target.value),r(s)},children:[t("option",{value:"",children:"All"}),t("option",{value:"indoor",children:"Indoor"}),t("option",{value:"outdoor",children:"Outdoor"})]})]}),c("div",{children:[t(N,{children:"Amenities"}),c(R,{name:"amenities",value:x,onChange:n=>{const u=Array.from(n.target.selectedOptions).map(p=>p.value);console.log({options:u}),A(u),s.delete("amenities"),u.forEach(p=>s.append("amenities",p)),r(s)},multiple:!0,children:[t("option",{value:"",children:"All"}),S.map(n=>t("option",{value:n._id,children:n.name},n._id))]})]})]})})}K.propTypes={open:C.bool.isRequired,onClose:C.func.isRequired};const Ae=()=>{var $;const[v,f]=h.useState(!1),[s,r]=h.useState(!1),o=h.useRef(null),[b,S]=h.useState(!1),[x,A]=h.useState(!1),[n,u]=h.useState(!1);let[p]=z();const{query:g,...H}=ee({queryKey:["spots","admin",...p.values()],queryFn:async(e,a)=>{const i=p.get("owner");i&&(e.owner=i);const l=p.get("_id");l&&(e._id=l),e["location.city"]=p.get("city")||void 0,e["location.state"]=p.get("state")||void 0,e.type=p.get("type")||void 0;const m=p.getAll("amenities").filter(Boolean);e["amenities[]"]=m;const U=await w.get("/product",{params:e,signal:a});return{data:U.data.products,total:U.data.total}}}),_=g.data,{mutateAsync:D}=xe(),{mutateAsync:j}=he(),{mutateAsync:k}=te(),O=async e=>{if(!e)return;const a=e.approved?"reject":"approve";await D({id:e._id,status:a},{onSuccess:()=>{F.success(`${e.approved?"Rejected":"Approved"} successfully`),g.refetch()},onError:i=>{F.error(i.response.data.message??"Something went wrong")}}),g.refetch()},L=async e=>{await F.promise(async()=>await j(e),{pending:"Deleting spot",success:"Spot deleted",error:"Failed to delete spot"}),g.refetch()},d=h.useCallback(e=>{o.current=e,S(!b)},[b]),y=h.useMemo(()=>[{id:"id",header:"ID",accessorFn:e=>e.id},{id:"createdAt",header:"Created At",accessorFn:e=>new Date(e.createdAt).toLocaleString()},{id:"owner.name",header:"Lister",accessorFn:e=>{var a;return(a=e==null?void 0:e.owner)==null?void 0:a.name}},{id:"name",header:"Name",accessorFn:e=>e.name},{id:"description",header:"Description",accessorFn:e=>e.description},{id:"price",header:"Price",accessorFn:e=>"$"+e.price},{id:"images",header:"Images",accessorFn:e=>{var a;return(a=e.images)==null?void 0:a.map(i=>`${w.defaults.baseURL}/product/images/${e._id}/${i}`)},enableSorting:!1,Cell:({renderedCellValue:e})=>{const a=e;return t("div",{className:"flex justify-start mx-4",children:t(E,{max:3,children:a==null?void 0:a.map(i=>t(M,{alt:"Remy Sharp",src:`${i}`},i))})})}},{id:"docs",header:"Documents",accessorFn:e=>e.docs.map(a=>`${w.defaults.baseURL}/product/docs/${e._id}/${a}`),Cell:({renderedCellValue:e})=>{const a=e;return t("div",{className:"flex justify-start mx-4",children:t(E,{max:3,children:a==null?void 0:a.map(i=>t(M,{alt:"Remy Sharp",src:`${i}`},i))})})}},{id:"amenities",header:"Amenities",accessorFn:e=>e.amenities,enableSorting:!1,Cell:({row:e})=>{const a=e.original.amenities;return t("div",{className:"flex justify-start mx-4",children:t(E,{max:3,children:a==null?void 0:a.map(i=>{const l=`${w.defaults.baseURL}/amenities/image/${i.image}`;return t(M,{alt:"Remy Sharp",src:l},i._id)})})})}},{id:"categories",header:"Categories",accessorFn:e=>e.categories,Cell:({row:e})=>{const a=e.original.categories;return t("div",{className:"flex justify-start mx-4",children:t(E,{max:3,children:a==null?void 0:a.map(i=>{const l=`${w.defaults.baseURL}/category/image/${i.image}`;return t(M,{alt:"Remy Sharp",src:l},i._id)})})})}},{id:"area",header:"Area (SqFt)",accessorFn:e=>`${e.area} SqFt`},{id:"location.city",header:"City",accessorFn:e=>e.location.city},{id:"location.state",header:"State",accessorFn:e=>e.location.state},{id:"location.road",header:"Road Name",accessorFn:e=>e.location.road},{id:"location.address",header:"Address",accessorFn:e=>e.location.address},{id:"availability",header:"Opening Time",enableSorting:!1,enableFilterMatchHighlighting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,Cell:({row:e})=>{const a=e.original.availability,i=Object.entries(a).filter(([l,m])=>!m.holiday);return t("div",{className:"!min-w-[200px] mx-4",children:i.map(([l,m])=>c("div",{className:"h-full flex justify-between",children:[t("div",{children:l}),t("div",{children:new Date(m.open).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]},`${l}-${m.open}-open-${e.original._id}`))})}},{id:"availability.close",header:"Closing Time",enableSorting:!1,enableFilterMatchHighlighting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,Cell:({row:e})=>{const a=e.original.availability,i=Object.entries(a).filter(([l,m])=>!m.holiday);return t("div",{className:"!min-w-[200px] mx-4",children:i.map(([l,m])=>c("div",{className:"h-full flex justify-between",children:[t("div",{children:l}),t("div",{children:new Date(m.close).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})]},`${l}-${m.close}-close-${e.original._id}`))})}},{id:"holidays",header:"Holiday's",accessorFn:e=>Object.entries(e.availability).filter(([a,i])=>i.holiday),width:500,Cell:({row:e})=>{const a=e.original.availability,i=Object.entries(a).filter(([l,m])=>m.holiday);return t("div",{className:"!min-w-[200px] mx-4",children:i.map(([l,m])=>t("div",{className:"h-full flex justify-between",children:t("div",{children:l})},`${l}-${m.close}-close-${e.original._id}`))})}},{id:"status",header:"Status",accessorFn:e=>e.approved,Cell:({renderedCellValue:e})=>c("div",{className:"flex items-center gap-2",children:[t("div",{className:"rounded-full text-xl",children:e===!0?t(q,{className:"text-green-500"}):e===!1?t(V,{className:"text-red-500"}):e==="Error"?t(ae,{className:"text-orange-500"}):null}),t("p",{className:"text-sm font-bold text-navy-700 ",children:e?"Approved":"Not Approved"})]})},{id:"actions",header:"Actions",accessorFn:e=>e._id,Cell:({row:e})=>t(le,{menu:{items:[{id:"edit",label:"Edit",icon:t(Se,{}),onClick:()=>{d(e.original)}},{id:"view",label:"Preview",icon:t(we,{}),onClick:()=>{o.current=e.original,f(!0)}},{id:"reservation",label:"View Reservation",icon:t(Ce,{}),onClick:()=>{o.current=e.original,r(!0)}},{id:"approve",label:e.original.approved?"Reject":"Approve",icon:e.original.approved?t(V,{}):t(q,{}),onClick:()=>O(e.original)},{id:"delete",label:"Delete",danger:!0,icon:t(re,{}),onClick:()=>L(e.original._id)},{id:"markAsFeatured",label:"Mark As Featured",icon:t(ie,{}),onClick:()=>k({product:e.original.id},{onSuccess:()=>{F.success("Marked as featured")},onError:a=>{console.log(a),F.error(a.response.data.message??"Something went wrong")}})}]},children:t("a",{onClick:a=>a.preventDefault(),children:c(se,{children:["Manage",t(ne,{})]})})})}],[d]);return c(G,{children:[t(T,{spot:o,disabled:!0,open:o.current&&v,onClose:()=>{f(!v),o.current=null},refetch:g.refetch}),t(T,{spot:o,open:o.current&&b,onClose:()=>S(!b),refetch:g.refetch}),t(de,{data:_,columns:y,...H,renderTopToolbarCustomActions:()=>c("div",{className:" flex gap-2 items-center",children:[t(I,{title:"Create New Spot",onClick:()=>{A(!0)},children:t(oe,{})}),t(I,{title:"Advanced Filter",onClick:()=>{u(!0)},children:t(ce,{className:"!text-2xl cursor-pointer"})})]})}),t(T,{open:x,onClose:()=>A(!x),refetch:g.refetch}),t(K,{open:n,onClose:()=>u(!n)}),t(ye,{open:o.current&&s,onClose:()=>r(!1),id:($=o.current)==null?void 0:$._id})]})},Je=()=>t(G,{children:t(Ae,{})});export{Je as default};
