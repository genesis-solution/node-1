import{s as b,l as s,d9 as y,aB as v,w as m,r as p,n as h,aF as w,aA as F,b1 as M,k as f,Q as g,bn as S,bp as R,bq as N,bo as T,F as A}from"./index-CYYMkemY.js";import{d as C}from"./Approval-DyJ50Uyj.js";import{d as P}from"./KeyboardArrowDown-6CoKOUEX.js";const k=b(a=>s(y,{elevation:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},...a}))(({theme:a})=>({"& .MuiPaper-root":{borderRadius:6,marginTop:a.spacing(1),minWidth:180,color:a.palette.mode==="light"?"rgb(55, 65, 81)":a.palette.grey[300],boxShadow:"rgb(255, 255, 255) 0px 0px 0px 0px, rgba(0, 0, 0, 0.05) 0px 0px 0px 1px, rgba(0, 0, 0, 0.1) 0px 10px 15px -3px, rgba(0, 0, 0, 0.05) 0px 4px 6px -2px","& .MuiMenu-list":{padding:"4px 0"},"& .MuiMenuItem-root":{"& .MuiSvgIcon-root":{fontSize:18,color:a.palette.text.secondary,marginRight:a.spacing(1.5)},"&:active":{backgroundColor:v(a.palette.primary.main,a.palette.action.selectedOpacity)}}}}));function x(a){const[o,t]=p.useState(null),c=!!o,[i,u]=p.useState([]),e=d=>{t(d.currentTarget)},r=()=>{t(null)},n=async()=>{try{u("resolving");const d=await f.patch(`/refund/${a.id}`,{approved:!0});g.success("Refund resolved successfully"),a.refresh(),u("resolved"),r()}catch{g.error("Something went wrong while resolving")}};return p.useEffect(()=>{console.log(a.id)},[a]),h("div",{children:[s(w,{id:"demo-customized-button","aria-controls":c?"demo-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":c?"true":void 0,variant:"contained",disableElevation:!0,disabled:a.paid===!0,onClick:e,endIcon:s(P,{}),children:"Actions"}),s(k,{id:"demo-customized-menu",MenuListProps:{"aria-labelledby":"demo-customized-button"},anchorEl:o,open:c,onClose:r,children:a.paid===!1&&h(F,{onClick:n,disabled:i==="resolving",children:[i==="resolving"?s(M,{size:"1rem",sx:{marginRight:1}}):s(C,{}),"Paid"]})})]})}x.propTypes={id:m.string,paid:m.bool,refresh:m.func};function H(){return S({queryKey:["refunds"],queryFn:async(a,o)=>{const{data:t}=await f.get("/refund",{signal:o,params:a});return t}})}const I=()=>{const a=H(),o=p.useMemo(()=>[{id:"order.id",header:"Booking ID",accessorFn:e=>{var r;return(r=e.order)==null?void 0:r.id}},{id:"order.products.product.name",header:"Spot",accessorFn:e=>{var r,n,d,l;return(l=(d=(n=(r=e.order)==null?void 0:r.products)==null?void 0:n[0])==null?void 0:d.product)==null?void 0:l.name}},{id:"order.products.owner.name",header:"Seller",accessorFn:e=>{var r,n,d,l;return(l=(d=(n=(r=e.order)==null?void 0:r.products)==null?void 0:n[0])==null?void 0:d.owner)==null?void 0:l.name}},{id:"seller_id",header:"Seller ID",accessorFn:e=>{var r,n,d,l;return((l=(d=(n=(r=e.order)==null?void 0:r.products)==null?void 0:n[0])==null?void 0:d.owner)==null?void 0:l.id)??"N/A"}},{id:"order.user.name",header:"Guest",accessorFn:e=>{var r;return(r=e.order.user)==null?void 0:r.name}},{id:"order.user.id",header:"Guest ID",accessorFn:e=>{var r;return(r=e.order.user)==null?void 0:r.id}},{id:"amount",header:"Amount",accessorFn:e=>"$"+e.amount},{id:"cancelation",header:"Type",accessorFn:e=>{var n;return((n=e.cancelation)==null?void 0:n.policy)||"No Refund"}},{id:"approved",header:"Paid",accessorFn:e=>e.approved,Cell:({renderedCellValue:e})=>h("div",{className:"flex items-center gap-2",children:[s("div",{className:"rounded-full text-xl",children:e===!0?s(R,{className:"text-green-500"}):e===!1?s(N,{className:"text-red-500"}):null}),s("p",{className:"text-sm font-bold text-navy-700 ",children:e===!0?"Paid":"Not paid yet"})]})},{id:"actions",header:"Actions",accessorFn:e=>e._id,Cell:({renderedCellValue:e,row:r})=>s(x,{id:e,paid:r.original.approved,toggleView:u,refresh:a.query.refetch})}],[a.query.refetch]),t=p.useRef(),[c,i]=p.useState(!1),u=e=>{console.log(e),t.current=a.data.filter(r=>r._id===e)[0],i(!c)};return s(A,{children:s(T,{columns:o,...a})})};function B(){return s("div",{children:s(I,{columnsData:[{Header:"Booking ID",accessor:o=>{var t;return`BK${(t=o.order)==null?void 0:t.bookingId}`},width:200},{Header:"Spot",accessor:o=>{var t;return((t=o.spot)==null?void 0:t.Name)??"deleted"},width:200},{Header:"Seller",accessor:o=>{var t,c,i,u;return`${(c=(t=o.spot)==null?void 0:t.lister)==null?void 0:c.firstName} ${(u=(i=o.spot)==null?void 0:i.lister)==null?void 0:u.lastName}`},width:200},{Header:"amt",accessor:o=>{var t;return((t=o.amtRequested)==null?void 0:t.toFixed(2))??"0.00"},width:200},{Header:"Type",accessor:o=>{var i;const t=(i=o.order)==null?void 0:i.amtPaid;return o.amtRequested===t?"100% refund":"50% refund"},width:200},{Header:"Paid",accessor:o=>o.paid,width:200},{Header:"Actions",width:200}],tableName:"Payout"})})}export{B as default};
